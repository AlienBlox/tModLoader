--- src/Terraria/Terraria/GameContent/ShopHelper.cs
+++ src/tModLoader/Terraria/GameContent/ShopHelper.cs
@@ -3,6 +_,7 @@
 using System.Collections.Generic;
 using Terraria.GameContent.Personalities;
 using Terraria.ID;
+using Terraria.ModLoader;
 using Terraria.Localization;
 
 namespace Terraria.GameContent
@@ -106,7 +_,7 @@
 					_currentPriceAdjustment *= 0.9f;
 				}
 
-				bool[] array = new bool[663];
+				bool[] array = new bool[NPCLoader.NPCCount];
 				foreach (NPC item in nearbyResidentNPCs) {
 					array[item.type] = true;
 				}
